/**handles:wdcp_comments**/
!function(e){e(function(){function t(){var t=e("#all-comment-providers").parent().parent().width(),r=e("#all-comment-providers li").length,n=e("#all-comment-providers li a").innerWidth(),i=e("#all-comment-providers li a").outerWidth(),o=t/r-(i-n);e("#all-comment-providers li a").width(o)}function r(t){var r=t.parents("li");if(!r.length)return!1;var n=e(t.attr("href"));if(!n.length)return!1;var i=e(".selected-comment-provider textarea:visible");e(".comment-provider, ul#all-comment-providers li").each(function(){e(this).removeClass("selected-comment-provider")}),n.addClass("selected-comment-provider"),r.addClass("selected-comment-provider");var o=n.find("textarea");o.length&&i.length&&o.val(i.val());var c=e(".comment-provider p.subscribe-to-comments, .comment-provider p.wdcp-mcls-subscription");return!c.length||(!o.length||n.attr("id").match(/twitter/)||n.attr("id").match(/wordpress/)?n.attr("id").match(/wordpress/)&&n.find("form").append(c):n.append(c),!0)}function n(e){return parseInt(e.attr("id").replace(/^.*comment-/,""),10)}function i(){var t=document.cookie.split(";"),r="";return e.each(t,function(t,n){return"wdcp_preferred_provider"!=e.trim(n.substr(0,n.indexOf("=")))||(r=e.trim(n.substr(n.indexOf("=")+1)),!1)}),unescape(r)}function o(e){var t=new Date;t.setDate(t.getDate()+365);var r=escape("comment-provider-"+e)+";expires="+t.toGMTString()+";path=/";document.cookie="wdcp_preferred_provider="+r}function c(e){var t=i();return t==e}e("a.comment-reply-link").unbind("click").after('<a class="comment-plus-reply-link" href="#comments-plus-form">'+_wdcp_data.text.reply+"</a>"),e("a.comment-reply-link").remove(),e(".no-instructions p.form-allowed-tags").remove(),_wdcp_data.fit_tabs&&(t(),e(window).resize(t)),e("a.comment-plus-reply-link").click(function(){var r=e(this).parents("li"),i=n(r);if(!i)return!1;var o=e("#comment-providers");return e(this).parents("li").first().append(o),e("#comment-providers").find("#comment_parent").val(i),o.find(".comments-plus-reply-cancel").length||o.append('<a class="comments-plus-reply-cancel" href="#">'+_wdcp_data.text.cancel_reply+"</a>"),e("#comment-providers").find("textarea:visible").focus(),_wdcp_data.fit_tabs&&t(),!1}),e(document).on("click",".comments-plus-reply-cancel",function(){e(this).remove();var t=e("#comment-providers");return e("#comment-providers").find("#comment_parent").val(0),e(".commentlist").after(t),!1}),e(document).on("click","#all-comment-providers li a",function(){return r(e(this)),!1}),e(document).on("click",".comment-provider-login-button a",function(){var t=e(this).parents(".comment-provider-login-button");if(!t.length)return!1;var r=t.attr("id").replace(/login-with-/,"");return!!r&&(e(document).trigger("wdcp_"+r+"_login_attempt"),!1)}),e(document).bind("wdcp_logged_in",function(t,n,i){var o=e("#login-with-"+n).parents(".comment-provider");e("#login-with-"+n).remove(),o.find(".comment-provider-waiting-response").length||o.append('<div class="comment-provider-waiting-response"></div>'),e.post(_wdcp_ajax_url,{action:"wdcp_get_form",provider:n,page:window.location.href},function(t){if(!t)return!1;o.empty().html(t.html);var a=e("#comment-provider-"+n+" .connected-as");return!!a.length&&(e("#comment-provider-"+n+"-link span").html(a.text()),void(i&&c("comment-provider-"+n)&&r(e("#comment-provider-"+n+"-link"))))})}),e(document).bind("wdcp_comment_sent",function(e,t){o(t)}),r(_wdcp_data&&_wdcp_data.preferred_provider&&e("#all-comment-providers li a#comment-provider-"+_wdcp_data.preferred_provider+"-link").length?e("#all-comment-providers li a#comment-provider-"+_wdcp_data.preferred_provider+"-link"):e("#all-comment-providers li a:first")),e(".connected-as").length&&e(".connected-as").each(function(){var t=e(this).first().parents("div.comment-provider");return!t.length||(!c(t.attr("id"))||(t.length&&r(e("#"+t.attr("id")+"-link")),!1))})})}(jQuery);